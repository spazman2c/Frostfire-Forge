let changePasswordButton=document.getElementById("changepassword-button"),emailInput=document.getElementById("changepassword-email"),passwordInput=document.getElementById("changepassword-password"),confirmPasswordInput=document.getElementById("changepassword-confirm-password"),currentURL=new URL(window.location.href),code=currentURL.searchParams.get("code"),email=currentURL.searchParams.get("email");code&&email||(window.Notify("error","Invalid or missing code or email"),window.location.href="/"),emailInput.value=email,emailInput.disabled=!0,changePasswordButton.addEventListener("click",async()=>{var e;code?passwordInput.value!==confirmPasswordInput.value?window.Notify("error","Passwords do not match"):(e=await fetch("/update-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:emailInput.value,password:passwordInput.value,password2:confirmPasswordInput.value,code:code})})).ok?(window.Notify("success","Password changed successfully. Redirecting to login..."),setTimeout(()=>{window.location.href="/"},3e3)):(e=(await e.json()).message||"Failed to change password",window.Notify("error",e,7e3)):window.Notify("error","Invalid or missing code")}),document.addEventListener("keydown",e=>{"Enter"===e.key&&changePasswordButton.click()});